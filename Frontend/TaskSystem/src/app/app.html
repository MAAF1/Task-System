<div class="page-shell">
  <header class="hero">
    <div>
      <p class="eyebrow">Task Management System</p>
      <h1>Role-based dashboard</h1>
      <p class="subtext">
        SuperAdmin can delete tasks, Admin can manage tasks, and Users can complete assigned work and feedback.
      </p>
    </div>
    <div class="header-actions" *ngIf="isAuthenticated">
      <span class="chip">{{ username }} Â· {{ roles.join(', ') }}</span>
      <button class="outline" type="button" (click)="logout()">Logout</button>
    </div>
  </header>

  <app-auth-panel
    *ngIf="!isAuthenticated"
    [authMode]="authMode"
    [form]="authForm"
    [message]="authMessage"
    (modeChange)="setMode($event)"
    (submitForm)="submitAuth()"
  ></app-auth-panel>

  <ng-container *ngIf="isAuthenticated">
    <app-admin-tasks-panel
      *ngIf="canManageTasks"
      [canDeleteTask]="canDeleteTask"
      [form]="taskForm"
      [assignedUsersInput]="assignedUsersInput"
      (assignedUsersInputChange)="assignedUsersInput = $event"
      [searchTitle]="searchTitle"
      (searchTitleChange)="searchTitle = $event"
      [tasks]="tasks"
      [message]="taskMessage"
      (create)="createTask()"
      (refresh)="loadTasks()"
      (search)="searchTasks()"
      (complete)="markCompleted($event)"
      (delete)="deleteTask($event)"
    ></app-admin-tasks-panel>

    <app-user-tasks-panel
      [tasks]="myTasks"
      [feedbackDrafts]="feedbackDrafts"
      (complete)="completeMyTask($event)"
      (feedbackChange)="updateFeedbackDraft($event.taskId, $event.value)"
      (saveFeedback)="saveMyFeedback($event)"
    ></app-user-tasks-panel>

    <p class="message panel" *ngIf="taskMessage && !canManageTasks">{{ taskMessage }}</p>
  </ng-container>
</div>
